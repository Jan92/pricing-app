<h2>{{ translate('properties.title') }}</h2>

<!-- Mobile Step-by-Step Ansicht -->
<div *ngIf="isMobile; else desktopView">
  <div *ngIf="mobileStep === 0">
    <h3>{{ translate('properties.dimensions') }}</h3>
    <mat-nav-list>
      <mat-list-item *ngFor="let dimension of dimensions$ | async" 
                    (click)="onSelectDimension(dimension)" 
                    [class.selected]="selectedDimension?.id === dimension.id">
        {{ getTranslatedDimensionName(dimension.id) }}
      </mat-list-item>
    </mat-nav-list>
  </div>
  <div *ngIf="mobileStep === 1">
    <button mat-stroked-button (click)="goBackMobileStep()" style="margin-bottom: 12px;">{{ translate('properties.backToDimensions') }}</button>
    <h3>{{ translate('properties.criteria') }} {{ getTranslatedDimensionName(selectedDimension?.id || '') }}</h3>
    <mat-nav-list>
      <mat-list-item *ngFor="let criterion of selectedDimension?.criteria" 
                    (click)="onSelectCriterion(criterion)"
                    [class.selected]="selectedCriterion?.id === criterion.id">
        {{ getTranslatedCriterionName(criterion.id) }}
      </mat-list-item>
    </mat-nav-list>
  </div>
  <div *ngIf="mobileStep === 2 && selectedCriterion && scaleForm && scaleLabels?.length === scoreRange.length">
    <button mat-stroked-button (click)="goBackMobileStep()" style="margin-bottom: 12px;">{{ translate('properties.backToCriteria') }}</button>
    <mat-card class="mat-elevation-z4">
      <mat-card-header>
        <mat-card-title>{{ translate('properties.scaleLabels') }} - {{ getTranslatedCriterionName(selectedCriterion.id) }}</mat-card-title>
        <mat-card-subtitle>{{ getTranslatedCriterionDescription(selectedCriterion.id) }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <form [formGroup]="scaleForm">
          <div formArrayName="scaleLabels">
            <div *ngFor="let score of scoreRange; let i = index" class="scale-item">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>{{ translate('common.score') }} {{ score }}</mat-label>
                <input matInput [formControlName]="i" [placeholder]="translate('properties.placeholder') + ' ' + score">
                <mat-hint>{{ translate('properties.hint') }}</mat-hint>
              </mat-form-field>
            </div>
          </div>
        </form>
      </mat-card-content>
      <mat-card-actions align="end">
        <button mat-button (click)="resetToDefaults()">{{ translate('properties.resetDefaults') }}</button>
        <button mat-raised-button color="primary" (click)="saveScaleLabels()">{{ translate('properties.save') }}</button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>

<!-- Desktop Ansicht -->
<ng-template #desktopView>
  <div class="score-properties-container">
    <div class="dimension-list">
      <h3>{{ translate('properties.dimensions') }}</h3>
      <mat-nav-list>
        <mat-list-item *ngFor="let dimension of dimensions$ | async" 
                      (click)="onSelectDimension(dimension)" 
                      [class.selected]="selectedDimension?.id === dimension.id">
          {{ getTranslatedDimensionName(dimension.id) }}
        </mat-list-item>
      </mat-nav-list>
    </div>

    <div class="criteria-list" *ngIf="selectedDimension">
      <h3>{{ translate('properties.criteria') }} {{ getTranslatedDimensionName(selectedDimension.id) }}</h3>
      <mat-nav-list>
        <mat-list-item *ngFor="let criterion of selectedDimension.criteria" 
                      (click)="onSelectCriterion(criterion)"
                      [class.selected]="selectedCriterion?.id === criterion.id">
          {{ getTranslatedCriterionName(criterion.id) }}
        </mat-list-item>
      </mat-nav-list>
    </div>

    <div class="scale-editor" *ngIf="selectedCriterion && scaleForm && scaleLabels?.length === scoreRange.length">
      <mat-card class="mat-elevation-z4">
        <mat-card-header>
          <mat-card-title>{{ translate('properties.scaleLabels') }} - {{ getTranslatedCriterionName(selectedCriterion.id) }}</mat-card-title>
          <mat-card-subtitle>{{ getTranslatedCriterionDescription(selectedCriterion.id) }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <form [formGroup]="scaleForm">
            <div formArrayName="scaleLabels">
              <div *ngFor="let score of scoreRange; let i = index" class="scale-item">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>{{ translate('common.score') }} {{ score }}</mat-label>
                  <input matInput [formControlName]="i" [placeholder]="translate('properties.placeholder') + ' ' + score">
                  <mat-hint>{{ translate('properties.hint') }}</mat-hint>
                </mat-form-field>
              </div>
            </div>
          </form>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-button (click)="resetToDefaults()">{{ translate('properties.resetDefaults') }}</button>
          <button mat-raised-button color="primary" (click)="saveScaleLabels()">{{ translate('properties.save') }}</button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</ng-template>

<div *ngIf="!selectedDimension && !isMobile" class="select-prompt">
  <p>{{ translate('properties.selectDimension') }}</p>
</div>

<div *ngIf="selectedDimension && !selectedCriterion && !isMobile" class="select-prompt">
  <p>{{ translate('properties.selectCriterion') }}</p>
</div>
